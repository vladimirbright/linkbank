{% extends "index.html" %}

{% load i18n webdesign pagination_tags gravatar %}

{% block title %}{% trans "Your links in bank!" %}{% endblock %}

{% block head-extra %}
<script type="text/javascript">

$(document).ready(function () {

  // Search form placeholder
  $("#id_href").bind("focus", function () {
    var initial, value;
    initial = "{{ form.href.field.initial|escapejs }}";
    value = $(this).val();
    if (initial == value) {
      $(this).val("");
    }
  });
  $("#id_href").bind("blur", function () {
    var initial, value;
    initial = "{{ form.href.field.initial|escapejs }}";
    value = $(this).val().trim();
    if (value == "") {
      $(this).val(initial);
    }
  });

  // Delete bookmark
  $(".del_bookmark").click(function () {
    var pk, dialog_div, ajax_url, clicked_link;
    clicked_link = $(this);
    pk = clicked_link.attr('id');
    ajax_url = clicked_link.attr('href');
    if (pk === null || ajax_url === null || ajax_url == "") {
        return false;
    }
    pk = pk.replace(/([^\d])+/, '');
    if (pk == "") {
        return false;
    }
    dialog_div = $('<div></div>');
    dialog_div.attr("title", $(this).attr("title"));
    dialog_div.html($(this).attr("rel"));
    $(dialog_div).dialog({
        modal: true,
        buttons: {
            "Ok": function () {
                dialog_div.html($("<div class='ajax_bar_div'></div>"));
                $(this).dialog("option", "buttons", false);
                $.ajax({
                  type: 'POST',
                  url: ajax_url,
                  success: function (data, status, xhr) {
                    dialog_div.html(data);
                  }
                });

            },
            "Cancel": function () {
                $(this).dialog("close");
            }
        }
    });
    return false;
  });

});
</script>
{% endblock %}

{% block header %}
  <div class="logout_div">
    <a title="{% trans "Sign out from site" %}" href="{% url logout %}">выйти</a>
  </div>

{% endblock %}

{% block content %}
<div class="content_inner">
  <div class="add_form_wrapper">
    <form action="{% url bank.views.link_create %}">
      {{ form.href }}
      <div class="form_submit_wrapper">
        <div class="form_submit_wrapper_inner" id="id_href_submit_wrapper">
          <input value="Add this!" type="submit">
        </div>
      </div>
    </form>
  </div>
  <div class="search_form_wrapper">
    <div class="form_submit_wrapper">
      <div class="form_submit_wrapper_inner" id="view_mode_wrapper">
      {% trans "View mode:" %} 
      <select>
        <option>{% trans "minimum" %}</option>
        <option>{% trans "normal" %}</option>
        <option>{% trans "maxmimum" %}</option>
      </select>
      </div>
    </div>

    <input type="text" name="q" value="Поиск" />

    <div class="form_submit_wrapper">
      <div class="form_submit_wrapper_inner" id="id_href_submit_wrapper">
        <input value="Search this!" type="submit">
      </div>
    </div>
  </div>

  <div id="main_container">

    <div class="breadcrumbs">
      <ul>
        <li><a title="{% trans "All links" %}" href="/">{% trans "Links" %}</a></li>
        <li><span>Теги: &laquo;Тег1&raquo;, &laquo;тег2&raquo;, &laquo;тег3&raquo;</span></li>
      </ul>
    </div>

    {% autopaginate links %}
    {% paginate %}
    <div class="link_wrapper mini">
      <ul>
      {% for l in links %}
          <li>
            <div class="abs_wrapper"><div class="rel_wrapper fav_wrapper">
              <img class="favicons" src="http://favicon.yandex.ru/favicon/{{ l.domain }}">
            </div></div>
            {% with l.title|default:l.href as href_title %}
              <a href="{{ l.href }}" title="{{ l.href }}" id="bookmark_{{ l.pk }}">
              {{ href_title|slice:":50" }}{% if href_title|length > 50 %}...{% endif %}
              </a>
              <div class="abs_wrapper"><div class="rel_wrapper work_link_wrapper">
                <a title="{% trans "Delete this link" %}" class="del_bookmark" href="{% url bank.views.link_delete l.pk %}"
                   rel="{% trans "Really delete " %} &laquo;{{ href_title }}&raquo; {% trans "this?" %}"
                   id="del_bookmark_{{ l.pk }}"><img src="{{ MEDIA_URL }}img/link_delete.png" /></a>
            </div></div>
            {% endwith %}
          </li>
      {% endfor %}
      </ul>
    </div>
    {% paginate %}
  </div>
</div>
{% endblock %}

{% block sidebar %}
  <div class="sidebar_username">
    <a href="#" title="{% trans "Profile, settings, password change & etc" %}">{{ user.username }}</a>
  </div>
  <img class="sidebar_gravatar" title="{% trans "Your gravatar" %}" src="{% gravatar_for_user user 90 %}" />
  <h4 class="sidebar_tags_title">{% trans "Tags" %}</h4>
  <ul class="sidebar_tags">
      <li>Tagname</li>
      <li>Tagname</li>
      <li class="ui-selected">Selected tag</li>
      <li>Tagname</li>
      <li>Tagname</li>
      <li>Tagname</li>
      <li>Tagname</li>
  </ul>
{% endblock %}
